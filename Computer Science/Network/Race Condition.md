## **Race Condition**

Race 뜻 그대로 경쟁하는 상태. 

두 개의 스레드가 하나의 자원을 놓고 서로 사용하려고 경쟁하는 상황

- 여러 프로세스들이 동시에 공유 데이터를 접근했을 때, 데이터에 대한 접근이 어떤 순서에 따라 이루어졌는지에 따라 실행 결과가 달라지는 상황
- race condition을 막기 위해서는 프로세스들을 동기화 시켜야 한다.

<br>

## **Critical Section(임계영역)**

> 통장에 돈이 **100만원** 있습니다. 지난달에 친구에게 빌렸던 **50만원**을 갚으려고 이체를 하고 있었습니다. 계좌번호와 금액을 입력하고 송금 버튼을 눌렀습니다. 그런데, 오늘 마침 카드값 **70만원**이 빠져나가는 날입니다. **정말정말 우연히 저의 이체와 카드값 이체가 동시에 일어났습니다**. 그런데 두 이체가 통장에 있는 잔액을 확인 했을 때 잔액은 100만원인데 이체들이 모두 성공해 버렸습니다. 이런 일이 계속 반복된다면 은행은 곧 파산하겠군요.😂
> 

이처럼 **통장**에 동시에 접근하게 되면 곤란한 문제가 생길 수 있습니다. 통장에 아무나 접근하지 못하게 보호를 해야 할 것 같습니다! 통장처럼 보호되어야 하는 부분 **Critical Section(임계영역)**이라고 합니다.

Critical Section에 접근하려면 각 프로세스의 code segment에 공유 데이터에 접근하는 코드를 사용합니다.

<br><br>

경쟁 프로세스의 경우, 세 가지 제어 문제에 직면한다.

1. **Mutual exclusion**
    
    Race condition을 막기 위해서는 두 개 이상의 프로세스가 공용 데이터에 동시에 접근을 하는 것을 막아야 한다. 
    
    한 프로세스가 공용 데이터를 사용하고 있으면 그 자원을 사용하지 못하도록 막거나, 다른 프로세스가 그 자원을 사용하지 못하도록 막으면 이 문제를 피할 수 있다. 
    
2. **Deadlock**
    
    그러나 상호 배제를 시행하면 추가적인 제어 문제가 발생한다. 
    
    하나는 교착상태, Deadlock이다.
    
    프로세스가 각자 프로그램을 실행하기 위해 두 자원 모두에 엑세스 해야 한다고 가정해보자.
    
    프로세스는 두 자원 모두를 필요로 하므로 필요한 두 리소스를 사용하여 프로그램을 수행할 때까지 이미 소유한 리소스를 해제하지 않는다. 이러한 상황에서 두 프로세스는 교착 상태에 빠지게 되는 문제가 발생할 수 있다.
    
3. **Starvation**
    
    제어 문제는 ‘기아 상태’라고도 한다. 
    
    프로세스들이 더 이상 진행을 하지 못하고 영구적으로 블록되어 있는 상태
    
    시스템 자원에 대한 경쟁 도중에 발생할 수 있고, 프로세스 간의 통신 과정에도 발생할 수 있는 문제이다. 두 개 이상의 작업이 서로 상대방의 작업이 끝나기만을 기다리고 있기 때문에 결과적으로는 아무것도 완료되지 못하는 상태가 되게 된다.
    

Race Condition 인 경우에 스레드의 실행 순서를 잘 조절해주지 않으면 이상한 상태, 비정상적인 상태가 나오게 된다. 이 문제는 항상 발생하는 것이 아니라 특정한 순서대로 수행되었을 때 발생하는 것이다. 이 문제는 디버깅을 할 때에는 전혀 보이지 않는 문제점이고, 발생 시에 모든 프로세스에 원하는 결과가 발생하는 것을 보장할 수 없으므로 후에 더욱 큰 문제를 야기할 수 있으므로 반드시 피해야 하는 상황이다.

이러한 문제가 발생하지 않도록, OS는 다른 프로세스의 의도하지 않은 간섭으로부터 각 프로세스의 데이터 및 물리적 자원을 보호해야 하며 여기에 메모리, 파일 및 I/O 장치와 관련된 내용이 포함된다.

프로세스에서 수행하는 내용과 프로세스가 생성하는 결과는, 다른 동시 프로세스의 실행 속도와 무관, 즉 기능과 결과는 서로 독립적이어야 한다.

<br>

## **Race Condition 해결을 위한 충족 조건 3가지**

1. **Mutual Exclusion (상호 배제)**
    
    어떤 프로세스가 임계 영역을 수행 중이면 다른 모든 프로세스들은 그 임계 영역에 들어가지 못하게 막는다.
    
2. **Progress(진행)**
    
    임계 영역에 들어간 프로세스가 있지 않은 상태에서 임계 영역에 들어가려는 프로세스가 있으면 들어가게 해주어야 한다. 즉, 임계영역에 있는 프로세스 외에는 다른 프로세스가 임계 영역에 진입하는 것을 방해하면 안된다.
    
3. **Bounded Waiting(한정 대기)**
    
    기아(starvation) 상태를 방지하기 위해 프로세스가 임계 영역에 들어가려고 요청한 후부터 다른 프로세스들이 임계 영역에 들어가는 횟수에 한계가 있어야 한다. 임계 영역에 한 번 들어갔다 나온 프로세스는 다음에 들어갈 떄 제한을 준다.
    
<br>

## **Race Condition 예방 방법**

### 1. **Semaphore(세마포어)**

### 2. **Mutex(뮤텍스)**
